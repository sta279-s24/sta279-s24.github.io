---
title: "Class activity"
output: 
  tufte::tufte_html:
    css: "lab.css"
    tufte_variant: "envisioned"
    highlight: pygments
link-citations: yes
---

**Instructions:** Work with a neighbor to answer the following questions. 

# GDP data

Run the following code to import data on GDP for each country (you may need to install the `googlesheets4` package):

```{r, message=F, warning=F}
library(tidyverse)
library(googlesheets4)
gs4_deauth()
gdp_data <- read_sheet("https://docs.google.com/spreadsheets/d/1RctTQmKB0hzbm1E8rGcufYdMshRdhmYdeL29nXqmvsc/pub?gid=0")
```

Looking at the data, we can see that there is a column for the GDP in each year, and the first column contains country information:

```{r}
head(gdp_data)
```


1. Use the `pivot_longer` function (in R), or the `melt` function (in Python) to reshape the GDP data so it looks like this:

```{r, echo=F}
gdp_data |>
  rename(country = starts_with("Income")) |>
  pivot_longer(cols = -country,
               names_to = "year",
               values_to = "gdp",
               values_drop_na = T)
```

* There should be no NAs
* The first column should be renamed `country`
* There should be separate columns for `year` and `gdp`

# WHO data

The `tidyr` package contains a dataset called `who2` which contains information on tuberculosis counts for each country in each year, broken down by method of diagnosis, sex, and age group:

```{r}
who2
```

Columns like `sp_m_1524` contain the number of tuberculosis cases. The column names contain information about the method of diagnosis (`rel`, `sn`, `sp`, or `ep`), sex (`f` or `m`), and age group (`014` = 0-14 years, `1524` = 15-24 years, etc.).

Ideally, we would like these variables to each have their own column. 

2. Using R or Python, reshape the `who2` data so it looks like this:

```{r, echo=F}
who2 |>
  pivot_longer(cols = -c(country, year),
               names_to = c("diagnosis", "sex", "age_group"),
               names_sep = "_",
               values_to = "count",
               values_drop_na = T)
```

* There should be no NAs
* There should be separate columns for `diagnosis`, `sex`, and `age_group`
* The `count` column contains the number of cases

# household data

The `household` data below contains information about five different households and the children in each household:

```{python, include=F}
import pandas as pd
```


```{python}
household = pd.DataFrame({
  'family': [1, 2, 3, 4, 5],
  'dob_child1': ["1998-11-26", "1996-06-22", "2002-07-11", "2004-10-10", "2000-12-05"],
  'dob_child2': ["2000-01-29", pd.NA, "2004-04-05", "2009-08-27", "2005-02-28"],
  'name_child1': ["Susan", "Mark", "Sam", "Craig", "Parker"],
  'name_child2': ["Jose", pd.NA, "Seth", "Khai", "Gracie"]
})
```

3. Reshape the `household` data in Python so it looks like this:

```{python, echo=F}
new_household = household.melt(id_vars = 'family')
new_household[['var', 'child']] = new_household['variable'].str.split('_', expand=True)
(new_household.drop('variable', axis='columns')
              .pivot(index = ['family', 'child'], 
                     columns = 'var', values = 'value')
              .dropna())
```

