---
title: "Homework 2"
output: 
  rmdformats::robobook:
    css: "homework.css"
    highlight: pygments
link-citations: yes
---

**Due:** Friday, February 2, 2:00pm on Canvas

**Instructions:** 

* Download the [HW 2 template](https://sta279-s24.github.io/homework/hw_2_template.qmd), and open the template (a Quarto document) in RStudio. 
* Put your name in the file header
* Click `Render`
* Type all code and answers in the document (using `###` for section headings and `####` for question headings)
* Render early and often to catch any errors!
* When you are finished, submit the final rendered HTML to Canvas

**Code guidelines:**

* If a question requires code, and code is not provided, you will not receive full credit
* You will be graded on the quality of your code. In addition to being correct, your code should also be easy to read
  * No magic numbers
  * Use descriptive names for your variables
  * Set seeds where needed
  * Comment code
  
**Resources:** Homework 2 will give you practice with loops, `if` statements, and simulation. In addition to the class notes and activities, I recommend reading the following resources:

* [Chapter 3.1 -- 3.2](https://adv-r.hadley.nz/vectors-chap.html) (an introduction to vectors) in *Advanced R*
* [Chapter 5](https://adv-r.hadley.nz/control-flow.html) (loops and choices) in *Advanced R*
* [Appendix C.2](https://mdsr-book.github.io/mdsr3e/C-algorithmic.html#simple-example) in *Modern Data Science with R*
* [Chapter 19.1 -- 19.5.2](https://r4ds.had.co.nz/functions.html) (functions and conditions) in *R for Data Science* (1st edition)
  
### Probability simulation

Suppose there are exactly 100 seats in a movie theater. Further, suppose the movie theater has imposed a new ticketing system where each person’s has an assigned seat number. Consider the case where the movie is sold-out (all 100 seats will be taken) and the first person in the theater lost their ticket and takes a random seat. Each subsequent person attempts to go to their seat. If their seat is open, they take it. Otherwise, to avoid confrontation, they choose a random seat. 

:::{.question}
#### Question 1

Conduct a simulation to assess the probability that the last person into the theater will get their assigned seat.

*Tips:* Here are some tips for one approach to this simulation.

* Create a vector `seats`, containing the numbers 1,...,100 in order, to represent the (numbered) seats in the theater
* Create a vector, `taken`, to represent which seats have been taken. At the beginning of each run of the simulation, all entries of `taken` are 0.
* When a seat gets taken, change the corresponding entry in `taken` to 1
* Use `sample` to randomly choose a seat from the ones available
* `seats[taken == 0]` will tell you which seats are available
:::
  
### Probability simulation

Consider the following $(a + 1)$ player game (Gal and Miltersen, 2007). There are $a$ boxes with labels $1, ..., a$ and slips of paper labeled $1, 2, ..., a$ The lead player colors each slip of paper either red or blue and puts each slip of paper in a box so there is one and only one slip of paper per box, without the other $a$ players observing.

Now, each player $i ∈ {1, 2, ..., a}$ can look in at most $a/2$ boxes and based on this make a guess about the color of the slip $i$. This done by each player in isolation. The $a$ players win if *every* player correctly announces the color of "their" slip.

:::{.question}
#### Question 2

Conduct a simulation where the lead player colors the slips and adds them to the boxes at random. The other players randomly choose which boxes to open. What proportion of the time do all of the players see their own slip, guaranteeing they win? Does the proportion depend on $a$?

*Tip:* To efficiently check whether a vector contains a specific value, you can use `%in%`. For example,

```{r}
3 %in% c(1, 2, 3)
4 %in% c(1, 2, 3)
```

:::

:::{.question}
#### Question 3

Conduct a simulation where the lead player colors the slips and adds them to the boxes at random. The other players randomly choose which boxes to open. Suppose a player that doesn’t see their own slip randomly guesses either red or blue. What proportion of the time do the $a$ players win?
:::

### Statistical simulation: looking at p-values

In class, we have discussed using statistical simulations to answer questions about statistical models. For example, we have asked whether the normality and constant variance assumptions really matter when fitting linear regression models.

To answer these questions, we need a *performance metric* (the "P" in the ADEMP steps). A performance metric tells us how well our methods are performing, so we can compare performance across different simulation scenarios.

One common method to measure performance, for a statistical model like a linear regression, is with the observed coverage of confidence intervals. If I create 95% confidence intervals, but their observed coverage is much less than 95%, then something is wrong!

An alternative, though related, method is to look at p-values from hypothesis tests. For example, consider the linear regression model

$$Y_i = \beta_0 + \beta_1 X_i + \varepsilon_i$$

We might test the hypotheses $H_0: \beta_1 = 0$ vs. $H_A: \beta_1 \neq 0$. This gives us a p-value, and we may choose to reject if the p-value is $< \alpha$ (common values of $\alpha$ include 0.05 and 0.01). If the null hypothesis $H_0$ is *true*, we would expect to *incorrectly* reject $H_0$ $\alpha \cdot 100%$ of the time. For example, if $\beta_1 = 0$, and we reject when $p < 0.05$, then we would expect to incorrectly reject $H_0$ 5% of the time. This is called the **type I error** rate.

In the following questions, we will use the type I error rate as an alternative performance measure for statistical simulations.

The code below simulates data from the linear regression model with all assumptions satisfied, and $\beta_1 = 0$. We then calculate the p-value for the test $H_0: \beta_1 = 0$ vs. $H_A: \beta_1 \neq 0$.

```r
n <- 100 # sample size
beta0 <- 0.5 # intercept
beta1 <- 0 # slope

x <- runif(n, min=0, max=1)
noise <- rnorm(n, mean=0, sd=1)
y <- beta0 + beta1*x + noise

lm_mod <- lm(y ~ x)
p_value <- summary(lm_mod)$coefficients[2,4]
```

(Remember that the type I error rate is the probability of rejecting $H_0$, given that $H_0$ is true!)

:::{.question}
#### Question 4

Repeat the code above many times. What fraction of times is the p-value less than 0.05? (i.e., what is our type I error rate when $\alpha = 0.05$?)
:::


:::{.question}
#### Question 5

Now break the normality assumption (you can adapt code from class). Does the type I error rate change?
:::


#### Power

The type I error rate measures hypothesis testing performance when $H_0$ is true. What about when $H_0$ is *false*? Then we can use **power**.

The **power** of a test is the probability of rejecting $H_0$, when $H_0$ is *false*. 

:::{.question}
#### Question 6

Re-run your code from question 4, but this time change the true slope to $\beta_1 = 0.2$. What fraction of times is the p-value less than 0.05? (i.e., what is our *power* to reject $H_0$?)
:::

Power depends on the actual value of $\beta_1$; if we change $\beta_1$, the ability to reject $H_0$ should also change.

:::{.question}
#### Question 7

Re-run your code from question 6, with different values of $\beta_1$. How does power change when you change $\beta_1$?
:::


