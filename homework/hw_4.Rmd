---
title: "Homework 4"
output: 
  rmdformats::robobook:
    css: "homework.css"
    highlight: pygments
link-citations: yes
---

**Due:** Friday, February 16, 2:00pm on Canvas

**Instructions:** 

* Download the [HW 4 template](https://sta279-s24.github.io/homework/hw_4_template.qmd), and open the template (a Quarto document) in RStudio. 
* Put your name in the file header
* Click `Render`
* Type all code and answers in the document (using `###` for section headings and `####` for question headings)
* Render early and often to catch any errors!
* When you are finished, submit the final rendered HTML to Canvas

**Code guidelines:**

* If a question requires code, and code is not provided, you will not receive full credit
* You will be graded on the quality of your code. In addition to being correct, your code should also be easy to read
  * No magic numbers
  * Use descriptive names for your variables
  * Set seeds where needed
  * Comment code
  * If a block of code is being called multiple times, put it in a function
  
**Resources:** In addition to the class notes and activities, I recommend reading the following resources:

* [Chapter 4](https://mdsr-book.github.io/mdsr3e/04-dataI.html) in *Modern Data Science with R*
* [Chapter 4](https://r4ds.hadley.nz/data-transform) in *R for Data Science* (2nd edition)

## Data wrangling in R

### NY Flights data

Let's begin with the `flights` data from the `nycflights13` package.

Suppose we want to know how many flights departed from each of the three NY airports (EWR, LGA, and JFK) in 2013. The `count` function allows us to count the number of rows, and to specify a variable to count by. Adding `sort = TRUE` will order the results from largest to smalles. For example:

```{r, message=F, warning=F}
library(nycflights13)
library(tidyverse)

flights |>
  count(origin, sort = TRUE)
```

We can see that 120835 departed from EWR in 2013.


:::{.question}
#### Question 1

Reproduce the output from the `count` function, but use the `group_by`, `summarize`, and `arrange` functions instead.
:::

:::{.question}
#### Question 2

The `dep_time` variable in the `flights` data records the actual departure time for each flight. However, there are several rows with missing departure times. Let's assume that these correspond to flights which were *cancelled*.

Which month had the highest proportion of cancelled flights?

*Hint:* the `is.na()` function will return `TRUE` if missing, and `FALSE` otherwise. For example:

```{r}
is.na(c(1, 2, NA, 3))
```

:::

:::{.question}
#### Question 3

Which plane (specified by the `tailnum` variable) traveled the most times from New York City airports in 2013?
:::

:::{.question}
#### Question 4

For the plane identified in question 3, plot the number of trips per week over the year.

To create this plot, you will need to determine the week of the year for each flight. The `week` function in the `lubridate` package may be helpful here...
:::

:::{.question}
#### Question 5

Which carrier has the worst average delays?
:::

:::{.question}
#### Question 6

For the results in question 5, can you disentangle the effects of bad airports vs. bad carriers? Why or why not?

*Hint*: Look at `table(flights$origin, flights$carrier)`
:::


### NY Health Inspections

The `Violations` data from the `mdsr` package contains information on 480621 health inspections conducted on restaurants in New York City. 

:::{.question}
#### Question 7

Use the `Violations` data to create a new data frame called `violations_summary`, which contains the median inspection score by zip code for zip codes in Manhattan with 50 or more inspections.

*Hint*: You will probably want to remove rows with missing observations for zip code, borough, or inspection score. The `drop_na` function can be useful here. Below is some starter code, you will need to complete the rest:

```{r, eval=F}
violations_summary <- Violations |>
  drop_na(zipcode, score, boro) |>
  ...
```

:::


:::{.question}
#### Question 8

Plot the number of median score vs. the number of inspections, using the `violations_summary` data you created in question 7.
:::


## Practice with lists

In class, we learned about lists as a hierarchical structure for storing data. In these questions, we will practice more with lists and list indexing.

:::{.question}
#### Question 9

Create a list, `x`, such that:

* `x[[2]][[1]]` stores the function `rnorm`. So,
`x[[2]][[1]](3)` should sample 3 numbers from a $N(0, 1)$ distribution.
* `x[[1]]` stores the function `rexp`. So, `x[[1]](3)` should sample 3 numbers from an Exponential distribution with rate 1.
* `x[[3]][[1]]` stores a function which samples from a $\chi^2_2$ distribution. So, `x[[3]][[1]](3)` should sample 3 numbers from a $\chi^2_2$ distribution.
:::


### Logistic regression

As you learned in STA 112, *linear* regression is used with quantitative responses, whereas *logistic* regression is used for binary responses ($Y_i = 0$ or $1$). In particular, if $\pi_i = P(Y_i = 1)$, then a simple logistic regression model (with explanatory variable $X_i$) is
$$\log \left( \frac{\pi_i}{1 - \pi_i} \right) = \beta_0 + \beta_1 X_i$$

As an example, consider a dataset of 3402 pitches thrown by MLB pitcher Clayton Kershaw in the 2013 season. The data is contained in the `Kershaw` data set, in the `Stat2Data` R package. We will focus on two specific variables for each pitch: 

* `Result`: a negative result (a ball or a hit), or a positive result (a strike or an out)
* `EndSpeed`: the speed at which the ball crossed home plate (in mph)

Our goal is to investigate the relationship between pitch speed and result. We can fit a logistic regression model, with `EndSpeed` as the explanatory variable and `Result` as the response:

```{r, message=F, warning=F}
library(tidyverse)
library(Stat2Data)
data("Kershaw")

log_reg <- glm(Result ~ EndSpeed, family = binomial, data = Kershaw)
summary(log_reg)
```

Here, `log_reg` is the resulting logistic regression model in R. What type of object is `log_reg`?

:::{.question}
#### Question 10

Use the `typeof` function to determine what type of object `log_reg` is.
:::

:::{.question}
#### Question 11

Use the `length` function to determine how many components are in the top level of `log_reg`. (There's a lot!)
:::

:::{.question}
#### Question 12

Let's look at the first component: use `log_reg[[1]]` to see what it contains. What is stored here?
:::

How were we meant to know that the first component of `log_reg` contained the coefficients? We probably wouldn't! Fortunately, R offers the option to *name* the components of a list, which makes it easier to access them without remembering all their indices. To get the coefficients, for example, we can run the following:

```{r}
log_reg[["coefficients"]]
```

Another way of accessing named entries in a list is with the `$`:

```{r}
log_reg$coefficients
```

We can see all the names for a list with the `names` function:

```{r}
names(log_reg)
```

This makes it easy to see what information the list contains!

:::{.question}
#### Question 13

How would you extract the AIC for your logistic regression model, *without* using the `summary` function? Write the code here.
:::

