---
title: "Homework 7 solutions"
format: 
  html:
    embed-resources: true
editor: source
author: "Ciaran Evans"
---

1.

```{r}
months <- tolower(lubridate::month(c(12, 1:7), label=T, abbr=F))
months
```

2.

```{r}
urls <- paste0("https://www.basketball-reference.com/leagues/NBA_2021_games-",
               months, ".html")
```

3.

```{r}
library(rvest)
library(tidyverse)

df_list <- list()

for(i in 1:length(urls)){
  df_list[[i]] <- read_html(urls[i]) |>
    html_element("table") |>
    html_table(header = TRUE, fill = TRUE)
}

df_list[[1]]
df_list[[2]]
```

4.

```{r, message=F, warning=F}
library(data.table)

nba <- rbindlist(df_list)
```

5.

```{r, message=F, warning=F}
colnames(nba) <- c("date", "start", "visitor", "visitor_pts", "home", "home_pts",
                   "v1", "v2", "attend", "arena", "notes")

nba <- nba |>
  mutate(attend = as.numeric(gsub(",", "", attend)))

nba |>
  mutate(diff = home_pts - visitor_pts) |>
  ggplot(aes(x = attend, y = diff)) +
  geom_point() +
  geom_smooth() +
  theme_bw() +
  labs(x = "Attendance", y = "Home pts - away pts")
```

6.

```{r}
nba |>
  mutate(month = tolower(lubridate::month(lubridate::mdy(date), 
                                          label=T, abbr=F))) |>
  mutate(month = factor(month, levels = months)) |>
  group_by(month) |>
  summarize(frac_0 = mean(attend == 0, na.rm=T)) |>
  ggplot(aes(x = month, y = frac_0)) +
  geom_point() +
  theme_bw() +
  labs(x = "Month", y = "Fraction of games with 0 attendees")
```


7.

```{r}
table_list <- read_html("https://en.wikipedia.org/wiki/The_Great_British_Bake_Off_(series_2)") |>
  html_elements("table.wikitable.sortable") |>
  html_table()
```

8.

```{r}
table_list[[1]]
```

9.


```{r}
table_list <- read_html("https://en.wikipedia.org/wiki/The_Great_British_Bake_Off_(series_5)") |>
  html_elements("table.wikitable.sortable") |>
  html_table()

table_list[[1]]
```

11.

```{r}
urls <- paste0("https://en.wikipedia.org/wiki/The_Great_British_Bake_Off_(series_", 
               2:13, ")")
contestants <- list()
for(i in 2:13){
  contestants[[i-1]] <- read_html(urls[i-1]) |>
    html_element("table.wikitable.sortable") |>
    html_table() |>
    rename(baker = starts_with("Baker"),
           age = starts_with("Age"),
           occupation = starts_with("occupation"),
           hometown = starts_with("hometown")) |>
    select(baker, age, occupation, hometown) |>
    mutate(series = i)
}

contestants <- rbindlist(contestants)
head(contestants)
```


12.

```{r}
contestants |>
  group_by(series) |>
  count()
```

13.

```{r}
contestants |>
  group_by(series) |>
  mutate(mean_age = mean(age)) |>
  ggplot(aes(x = series, y = mean_age)) +
  geom_point()
```



